<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>タイピングゲーム</title>
    <meta name="author" content="YuSan357">
    <link rel="stylesheet" href="css/style.css">
    <style>
      /* ゲーム操作画面関連 */
      #gameController {
        margin: 50px auto 0;
        width: 400px;
        /* text-align: center; */
        /* color: #333; */
      }

      /* 結果レポート関連 */
      #resultReport {
        margin: 50px auto 0;
        width: 500px;
        padding: 5px;
        background-color: #fff;
        border-radius: 10px;
        text-align: center;
        transition: 0.8s;
      }
      #reportTitle {
        font-size: 25px;
        font-weight: bold;
      }

      /* コマンド関連 */
      .godmodeStyle {
        background-color: #f8a1a1;
      }
    </style>
  </head>
  <body>
    <header>
      <a id="logo" href="index.html">シンプル☆タイピングゲーム</a>
    </header>

    <main>
      <div id="gameController">
        <p id="timerPara">default-string</p>
        <p id="instructionPara">default-string</p>
        <input type="text" id="textbox" value="default-string" disabled>
        <p id="typedWordsCountPara">default-string</p>
        <p id="highestRecordPara">default-string</p>
        <button id="startButton" onclick="startButtonClick()" autofocus>default-string</button>
      </div>
      <div id="resultReport">
        <p id="reportTitle">結果レポート</p>
        <p id="resultOfPlayTimePara">default-string</p>
        <p id="resultOfTypedWordsCountPara">default-string</p>
        <!-- <p>評価：★★★☆☆</p> -->
      </div>
    </main>

    <footer>
      <p>©YuSan357</p>
    </footer>

    <script>
      const wordList = [
        "りんご","青りんご","イチゴ","人参","大根","スイカ","みかん","味噌汁",
        "あさり","さくらんぼ","じゃがいも","卵","きゅうり","ぶどう","なす",
        "かぼちゃ","もやし","ねぎ","もやし","桃","ゆず","たまねぎ","しょうが","牛丼",
        "コーンスープ","かつ丼","ハンバーグ","豚骨ラーメン","カレーライス","うどん","にゅうめん","フライドポテト","ピッツァ","天ぷら",
        "肉まん","たこ焼き","明石焼き","オムライス","しらす","しらすラーメン","パスタ","ガパオライス","カルボナーラ","ペペロンチーノ","グラタン",
        "ドリア","醤油ラーメン","味噌ラーメン","塩ラーメン","にぼし","つけめん","そうめん","寿司","サラダ","コーヒー","ドーナツ","ショートケーキ","バームクーヘン",
        "ムース","マドレーヌ","刺身","親子丼","海鮮丼","焼肉","おでん","目玉焼き","卵焼き","チーズトースト","スクランブルエッグ","ツナ缶","パフェ","プリン","ソーダ",
        "コーラ","ウーロン茶","牛乳","爽健美茶","緑茶","麦茶","天然水","ココア","トマトジュース","野菜ジュース"
      ];


      //bodyタグのid取得
      const body = document.body;
      //gameController部の各要素のid取得
      const timerPara = document.getElementById("timerPara");
      const instructionPara = document.getElementById("instructionPara");
      const textbox = document.getElementById("textbox");
      const typedWordsCountPara = document.getElementById("typedWordsCountPara");
      const startButton = document.getElementById("startButton");
      const highestRecordPara = document.getElementById("highestRecordPara");
      //resultReport部の各要素のid取得
      const resultReport = document.getElementById("resultReport");
      const resultOfPlayTimePara = document.getElementById("resultOfPlayTimePara");
      const resultOfTypedWordsCountPara = document.getElementById("resultOfTypedWordsCountPara");

      
      //ゲーム関連の変数
      let targetText; //目標の単語
      let typedWordsCount = 0; //入力に成功した単語数
      let highestRecord = 0; //歴代の最高成績
      //タイマー関連の変数
      const defaultRemaingTime = 30; //残り時間の初期値
      let remaingTime = defaultRemaingTime; //残り時間
      //状態管理用のboolean型変数
      let isGamePlaying = false; //true = ゲームプレイ中
      let isInput10 = false; //true = 入力成功単語数10倍モードON
      let isAutoInput = false; //true = 自動入力モードON
      

      //ゲーム開始準備
      timerPara.textContent = "残り時間：" + defaultRemaingTime + "秒";
      instructionPara.textContent = "startボタンをクリックしてください";
      textbox.value = "";
      textbox.addEventListener("keypress",enterKeyListener);
      typedWordsCountPara.textContent = "入力できた単語数：0";
      highestRecordPara.textContent = "最高記録：0";
      startButton.textContent = "ゲームスタート";
      resultReport.style.transform = "scale(0)";
      

      function startButtonClick(){
        if(!isGamePlaying){
          gameStart();
        }else{
          gameFinish();
        }
      }
      
      
      function gameStart(){
        timerStart();
        isGamePlaying = true;
        typedWordsCount = 0;
        textbox.disabled = false;
        textbox.focus();
        nextQuiz();

        timerPara.textContent = "残り時間：" + defaultRemaingTime + "秒";
        scaleup(timerPara);
        typedWordsCountPara.textContent = "入力できた単語数：" + 0;
        scaleup(typedWordsCountPara);
        startButton.textContent = "リタイアする";
        resultReport.style.transform = "scale(0)";
      }
      
      
      function gameFinish(){
        clearInterval(timer);
        isGamePlaying = false;
        isAutoInput = false;
        isInput10 = false;
        body.classList.remove("godmodeStyle");
        textbox.disabled = true;
        
        if(typedWordsCount >= highestRecord){
          highestRecord = typedWordsCount; //最高記録を更新！
          highestRecordPara.textContent = "最高記録：" + highestRecord;
          scaleup(highestRecordPara);
        }

        startButton.textContent = "もう一度プレイ";
        updateResultReport();
        resultReport.style.transform = "scale(1.2)";
      }
      
      
      function updateResultReport(){
        resultOfPlayTimePara.textContent = "プレイ時間：" + (defaultRemaingTime - remaingTime) + "秒";
        resultOfTypedWordsCountPara.textContent = "入力できた単語数：" + typedWordsCount;
      }
      
      
      function timerStart(){
        let countup = function(){
          remaingTime--;
          timerPara.textContent = "残り時間：" + remaingTime + "秒";
          scaleup(timerPara);
          if(remaingTime <= 0){
            clearInterval(timer);
            gameFinish();
          }
        }
        remaingTime = defaultRemaingTime;
        timer = setInterval(countup,1000); //countup開始
      }
      

      function enterKeyListener(event){
        if(event.key == "Enter"){
          textboxCheck();
          textbox.value = "";
        }
      }


      function textboxCheck(){
        if(textbox.value == targetText){
          updateTypedWordsCount();
          nextQuiz();
        }
        if(textbox.value == "auto input"){
          isAutoInput = true;
          body.classList.add("godmodeStyle");
          nextQuiz();
        }
        if(textbox.value == "input * 10"){
          isInput10 = true;
          body.classList.add("godmodeStyle");
        }
        if(isAutoInput){
          textbox.value = targetText;
          setTimeout(() => {
            textboxCheck();
          }, 100);
        }
      }

      
      function nextQuiz(){
        let randomNum = Math.floor(Math.random() * wordList.length);
        targetText = wordList[randomNum];
        instructionPara.textContent = "「" + targetText + "」 と入力してください";
        scaleup(instructionPara);
      }


      function updateTypedWordsCount(){
        if(isInput10){
          typedWordsCount += 10;
        }else{
          typedWordsCount++;
        }
        typedWordsCountPara.textContent = "入力できた単語数：" + typedWordsCount;
        scaleup(typedWordsCountPara);
      }


      function scaleup(para){
        //JavaScriptでCSSスタイルを追加できる！
        para.style.transition = "0.2s";
        para.style.transform = "scale(1.02)";
        setTimeout(() => {
          para.style.transform = "scale(1)";
        }, 200);
      }


    </script>
    
  </body>
</html>